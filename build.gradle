plugins {
    id 'java'
    id 'application'
    id 'edu.sc.seis.launch4j' version '3.0.5'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}


ext {
    // Define osgi.platform for SWT dependency resolution
    setProperty('osgi.platform', 'win32.win32.x86_64')
}

group = 'org.tvrenamer'
version = '1.0.0-SNAPSHOT'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // SWT - using platform specific dependency for Windows build
    // Exclude transitive dependencies to prevent resolution of '${osgi.platform}'
    implementation('org.eclipse.platform:org.eclipse.swt.win32.win32.x86_64:3.124.0') {
        transitive = false
    }

    // Core dependencies - modernized
    implementation 'com.thoughtworks.xstream:xstream:1.4.20'
    implementation 'commons-codec:commons-codec:1.16.0'
    implementation 'xpp3:xpp3_min:1.1.4c' // Often needed by XStream legacy
    implementation 'xmlpull:xmlpull:1.1.3.1'

    // Networking
    implementation 'com.squareup.okhttp3:okhttp:4.12.0'

    // Testing
    testImplementation 'junit:junit:4.13.2'
}

application {
    mainClass = 'org.tvrenamer.controller.Launcher'
    // Default JVM args if needed
    // applicationDefaultJvmArgs = []
}

launch4j {
    mainClassName = 'org.tvrenamer.controller.Launcher'
    icon = "${projectDir}/src/main/resources/icons/oldschool-tv-icon.ico"
    jarTask = project.tasks.shadowJar
    outfile = "TVRenamer.exe"
    downloadUrl = "http://java.com/download"
    headerType = "gui"
    requires64Bit = true
    jreMinVersion = "17"
}

tasks.named('processResources') {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

// Shadow plugin configuration for integrated JAR with all dependencies
shadowJar {
    archiveClassifier.set('')
    mergeServiceFiles()
    // Ensure proper handling of SWT and native libraries
}


    main {
        java {
            srcDir 'src/main/java'
        }
        resources {
            srcDir 'src/main/resources'
        }
    }


    test {

        java {

            srcDir 'src/test/java'

        }

    }

}

tasks.named('jar') {
    enabled = false
}

tasks.named('launch4j') {
    dependsOn(tasks.named('shadowJar'))
}
